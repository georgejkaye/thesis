\section{Algebraic semantics for Belnap logic}\label{sec:algebraic-belnap}

For a sound and complete equational theory, equations are required to bring any
essentially combinational circuit into a canonical form.
Recall from \cref{sec:denotational-belnap} that the canonical form for circuits
using components in the Belnap signature \(\belnapsignature\) is a circuit that
`explodes' its inputs into two circuits computing the `falsy' and the `truthy'
components of the output, before joining these together.

Since this form is a variation of the standard disjunctive normal form for
Boolean circuits, most of the equations required here should be familiar.

\begin{definition}
    Let the set \(\mathcal{X}\) of \emph{explosion equations} be defined as
    in \cref{fig:explosion-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/explode-equations}

Most of the equations in \(\mathcal{X}\) are well-known; the only interesting
one is \((\belnapexpeqn)\).
This says that we can always `explode' a wire into (trivial) falsy and truthy
subcircuits before joining them back together.
While on its own this may not seem very useful, when combined with the other
equations it sets the stage for translating an entire circuit into an exploded
form.

\begin{lemma}
    The equations in \cref{fig:explosion-equations} are sound.
\end{lemma}
\begin{proof}
    By checking all the inputs.
\end{proof}

The purpose of the explosion equations is to translate any circuit into an
exploded form.
Broadly, the strategy here is to use the \((\belnapexpeqn)\) equation to
introduce an empty explosion on the right of a circuit, then use the remaining
equations to push the components of the original circuit inside the explosion.
The first thing to do, then, is to be able to propagate essentially
combinational circuit components across the opening forks of the explosion.

\begin{lemma}\label{lem:explode-copy}
    For any essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=n,colour=seq]
    \), the equation \(
    \iltikzfig{strings/structure/cartesian/naturality-copy-lhs}[colour=comb,box=f]
    =
    \iltikzfig{strings/structure/cartesian/naturality-copy-rhs}[colour=comb,box=f]
    \) in \(\scirc{\belnapsignature} / \mathcal{X}\).
\end{lemma}
\begin{proof}
    This follows for the combinational generators by applying
    \((\joinforkeqn)\), \((\botforkeqn)\), \((\andforkeqn)\), \((\orforkeqn)\),
    \((\notforkeqn)\), and is immediate for the fork.
    The infinite register \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=v]
    \) can also be treated as a base case and is covered by \((\infregforkeqn)\).
    The inductive cases are then trivial.
\end{proof}

\begin{proposition}\label{prop:exploded-belnap}
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
    \), there exists combinational Belnap circuits \(
    \iltikzfig{strings/category/f-3-1}[box=f_0,dom1=1,dom2=m,dom3=m,cod=1,colour=comb]
    \) and \(
    \iltikzfig{strings/category/f-3-1}[box=f_1,dom1=1,dom2=m,dom3=m,cod=1,colour=comb]
    \) containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators, such that \[
        \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
        =
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form}[box=f,dom=m,cod=1].
    \]
\end{proposition}
\begin{proof}
    First we consider the base cases.
    If \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is just the identity, then it can be transformed into the desired form
    with
    \((\belnapexpeqn)\).
    Since \(\iltikzfig{strings/category/f}[box=f,colour=seq]\) has codomain
    \(1\) it cannot be a symmetry.
    For the other generators and the infinite register,
    \((\belnapexpeqn)\) can first be applied to the output wire to create the
    exploded `skeleton', followed by using \cref{lem:explode-copy} to copy the
    components into four, and the pushing the copies through the translators
    using \((\joinforkeqn)\), \((\joinandeqn)\), \((\joinoreqn)\),
    \((\botforkeqn)\), \((\botoreqn)\) \((\andcomm)\), \((\orcomm)\),
    \((\andorddisteqn)\), \((\oranddisteqn)\), \(\botforkeqn\), \((\infregandeqn)\),
    \((\infregoreqn)\), \((\infregnoteqn)\), \((\demorganand)\),
    \((\demorganor)\), \((\botnoteqn)\), \((\botandeqn)\), and \((\botoreqn)\).
    As propagating the \(
    \iltikzfig{circuits/components/gates/not}
    \) flips the translators by using \((\demorganand)\) and \((\demorganor)\),
    \((\forkcommeqn)\) must be used to restore the correct order of the
    translators, and \((\dneeqn)\) is used to eliminate additional
    \(\iltikzfig{circuits/components/gates/not}\) gates.
    Any infinite registers containing \(\bot\) can be converted to
    \(\iltikzfig{strings/structure/monoid/init}[colour=comb]\) components using
    \((\botregeqn)\), and any other registers can be combined into one by
    \((\infregforkeqn)\).

    For composition, we have \[
        \iltikzfig{circuits/axioms/belnap/translation/exploded-composition}.
    \]
    By \cref{lem:explode-copy}, the first circuit can be propagated across
    the forks at the start of the second circuit.
    This means that each of the four `translators' has as input a copy of the
    first circuit.
    Using the same strategy as for the base case the components of the circuit
    can then be propagated across the translators.
    For tensor, the circuits can be interleaved using axioms of STMCs.
\end{proof}

This form already looks very similar to a circuit in the image of
\(\mealytofunc\) in that it is the join of two circuits prefixed by
`translators'.
However, these two circuits are not necessarily in the correct form specified by
\(\mealytofunc\).
Both circuits are constructed in a way to simulate the disjunctive normal form
procedure in the Boolean realm.
In the \emph{truthy} circuit this looks as one might expect, but in the
\emph{falsy} circuit everything is flipped.

\begin{definition}[Conjunction]
    A Belnap circuit is a \emph{truthy conjunction} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunction}[ccolour=seq]
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is another truthy conjunction.
    A Belnap circuit is a \emph{falsy conjunction} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnapfalse]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/disjunction}[dcolour=seq]
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is another falsy conjunction.
\end{definition}

\begin{definition}[Disjunctive normal form]
    A Belnap circuit is in \emph{truthy disjunctive normal form} if it is \(
    \iltikzfig{strings/structure/monoid/init}[colour=comb]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/disjunctive-normal}[ccolour=seq]
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is in truthy disjunctive normal form and \(
    \iltikzfig{strings/category/f}[box=g, colour=seq]
    \) is a truthy conjunction.
    A Belnap circuit is in \emph{falsy disjunctive normal form} if it is \(
    \iltikzfig{strings/structure/monoid/init}[colour=comb]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunctive-normal}[dcolour=seq]
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is in falsy disjunctive normal form and \(
    \iltikzfig{strings/category/f}[box=g, colour=seq]
    \) is a falsy conjunction.
\end{definition}

The equations required to bring circuits into disjunctive normal
form are standard.

\begin{definition}
    Let \(\mathcal{F}\) be defined as the set of \emph{normal form equations}
    listed in \cref{fig:normal-form-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/normal-form-equations}

We will now show that these equations suffice to translate the subcircuits in
the exploded circuit into falsy or truthy disjunctive normal form.
To do this, we will use some notation for composite forks.

\begin{definition}\label{def:mk-fork}
    For \(n \in \nat\), an \emph{\(m,k\)-fork}
    \(\iltikzfig{circuits/components/structural/mn-fork}\)
    is defined
    inductively with \(
    \iltikzfig{circuits/components/structural/m0-fork} \coloneqq
    \iltikzfig{strings/category/identity-blank}[obj=m]
    \) and \(
    \iltikzfig{circuits/components/structural/mkp1-fork} \coloneqq
    \iltikzfig{circuits/components/structural/n-fork}
    \).
\end{definition}

First we consider disjunctive normal form; to this end we will need to translate
a circuit of \(\iltikzfig{circuits/components/gates/and}\) components into a
conjunction.

\begin{lemma}\label{lem:conjunction-normalising}
    Given a essentially combinational Belnap circuit \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f,dom=m,cod=1,values=\belnaptrue]
    \) containing no \(
    \iltikzfig{circuits/components/gates/or}
    \) or \(
    \iltikzfig{circuits/components/gates/not}
    \) components, there exists a tensor of \(n\) truthy conjunctions \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=mn,cod=n]
    \) such that \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{circuits/algebraic/unction-circuit}
    \) in \(\scirc{\belnapsignature} / \mathcal{F}\).
\end{lemma}
\begin{proof}
    Repeatedly applying \((\andforkeqn)\) to \(
    \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
    \) propagates the \(
    \iltikzfig{circuits/components/gates/and}
    \) components as far to the right
    as possible.
    This divides \(
    \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
    \) into several parts: \(n\) parallel circuits \(
    \iltikzfig{strings/category/f}[box=h_i,colour=seq,dom=p_0,cod=n]
    \) containing identities and \(
    \iltikzfig{circuits/components/gates/or}
    \) components, and potentially infinite registers, and a circuit \(
    \iltikzfig{strings/category/f}[box=g_0,colour=comb,dom=m,cod={\Sigma_{i<n}\ p_i}]
    \) containing only structural generators.
    \[
        \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
        =
        \iltikzfig{circuits/algebraic/belnap-after-copying}
    \]
    By using \((\forkcommeqn)\), \((\forkassoceqn)\) and \((\forkuniteqn)\),
    we can translate the circuit such that each of the \(m\) input wires forks
    into each `branch', even if it is immediately eliminated.
    Again by \((\forkcommeqn)\) and \((\forkassoceqn)\), these forks can be
    brought to the form of \cref{def:mk-fork}.
    This means we have \[
        \iltikzfig{circuits/algebraic/belnap-after-copying}
        =
        \iltikzfig{circuits/algebraic/belnap-rearrange-forks}
    \]
    In a conjunction \(x_0 \land x_1 \land \dots \land x_{n-1}\), any duplicate
    variables can be removed due to idempotency.
    This can be replicated syntactically using the \((\andidemeqn)\) equation;
    to translate the circuit into a form where this can be applied may
    additionally require the use of the \((\forkcommeqn)\), \((\forkassoceqn)\),
    \((\andassoc)\) and \((\andcomm)\) equations.

    Finally, if the infinite register required in a conjunction is not present,
    we introduce it using the \((\andideqn)\) equation.

    By repeating this for each subcircuit \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=m,cod=1]
    \), the proof is completed.
\end{proof}

\begin{example}
    \todo[inline]{Example}
\end{example}

Now that we can create disjunctions, we are able to create a circuit in
conjunctive normal form.

\begin{proposition}\label{prop:conjunctive-normal-form}
    Let \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) be an essentially combinational Belnap circuit containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators.
    Then there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) containing only structural generators, a Belnap circuit \(
    \iltikzfig{strings/category/f-2-1}[box=h,colour=comb,dom1=x,dom2=m,cod=n]
    \) in conjunctive normal form, and values \(\listvar{v} \in \valuetuple{x}\)
    such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{circuits/algebraic/belnap-normal}[box1=g,box2=h,val=\listvar{v}]
    \) in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    As \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is essentially combinational, it can be written in the form \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f^\prime]
    \).
    By applying repeatedly \((\andorddisteqn)\), the combinational circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) can then be translated into a conjunction of circuits.
    These circuits will only contain \(
    \iltikzfig{circuits/components/gates/or}
    \) components, so the remainder of the proof follows by
    \cref{lem:or-normalising}.
\end{proof}

The above results apply to circuits in conjunctive normal form, but with some
simple tweaks they can be used for disjunctive normal form as well.

\begin{lemma}\label{lem:and-normalising}
    Given an essentially combinational circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \) containing only registers, \(
    \iltikzfig{circuits/components/gates/and}
    \) components, there exists a circuit
    \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=m,cod=mn]
    \) containing only structural generators, and a circuit
    \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) containing only identities and \(
    \iltikzfig{circuits/components/gates/and}
    \) components such that \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) is the tensor of \(n\) disjunctions \(
    \iltikzfig{strings/category/f}[box=h_i,colour=seq,dom=m,cod=1]
    \), and \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{strings/category/composition}[box1=g,box2=h,colour=comb]
    \) by equations in \(\mathcal{F}\).
\end{lemma}
\begin{proof}
    As \cref{lem:or-normalising}, but by using the \(\andgate\) version of the
    relevant equations, i.e.\ \((\andforkeqn)\), \((\andassoc)\) and \((\andidemeqn)\).
\end{proof}

\begin{proposition}\label{prop:disjunctive-normal-form}
    Let \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) be an essentially combinational Belnap circuit containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators.
    Then there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) containing only structural generators, a Belnap circuit \(
    \iltikzfig{strings/category/f-2-1}[box=h,colour=comb,dom1=x,dom2=m,cod=n]
    \) in disjunctive normal form, and values \(\listvar{v} \in \valuetuple{x}\)
    such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{circuits/algebraic/belnap-normal}[box1=g,box2=h,val=\listvar{v}]
    \) in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    As \cref{prop:conjunctive-normal-form}, but using \((\andorddisteqn)\) and
    applying \cref{lem:and-normalising} to the result.
\end{proof}

Putting this all together gives us the desired canonical form theorem.

\begin{theorem}
    Let \(
    \morph{\mealytofunc_\belnap}{\func{\interpretation_{\belnap}}}{\ccirc{\Sigma_\belnap}}
    \) be a map induced by functional completeness of the Belnap interpretation
    in the previous section.
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \), there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in the image of \(\mealytofunc_\belnap\) such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in \(\ccirc{\Sigma_\belnap} / \mathcal{X} + \mathcal{F}\).
\end{theorem}
\begin{proof}
    \cref{prop:exploded-belnap}, \cref{prop:conjunctive-normal-form},
    \cref{prop:disjunctive-normal-form} can be applied in
    sequence to create a circuit of the correct form.
    By using \((\forkuniteqn)\), \((\forkassoceqn)\) and \((\forkcommeqn)\) the
    initial construct of forks and symmetries can be adjusted until it in the
    image of \(\mealytofunc_\belnap\), however it was initially defined.
\end{proof}
