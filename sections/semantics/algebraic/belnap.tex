\section{Algebraic semantics for Belnap logic}\label{sec:algebraic-belnap}

For a sound and complete equational theory, equations are required to bring any
essentially combinational circuit into a canonical form.
Recall from \cref{sec:denotational-belnap} that the canonical form for circuits
using components in the Belnap signature \(\belnapsignature\) is a circuit that
`explodes' its inputs into two circuits computing the `falsy' and the `truthy'
components of the output, before joining these together.

Since this form is a variation of the standard disjunctive normal form for
Boolean circuits, most of the equations required here should be familiar.

\begin{definition}
    Let the set \(\mathcal{X}\) of \emph{explosion equations} be defined as
    in \cref{fig:explosion-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/explode-equations}

Most of the equations in \(\mathcal{X}\) are well-known; the only interesting
one is \((\belnapexpeqn)\).
This says that we can always `explode' a wire into (trivial) falsy and truthy
subcircuits before joining them back together.
While on its own this may not seem very useful, when combined with the other
equations it sets the stage for translating an entire circuit into an exploded
form.

\begin{lemma}
    The equations in \cref{fig:explosion-equations} are sound.
\end{lemma}
\begin{proof}
    By checking all the inputs.
\end{proof}

\begin{lemma}\label{lem:explode-copy}
    For any essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=n,colour=seq]
    \), the equation \(
    \iltikzfig{strings/structure/cartesian/naturality-copy-lhs}[colour=comb,box=f]
    =
    \iltikzfig{strings/structure/cartesian/naturality-copy-rhs}[colour=comb,box=f]
    \) in \(\ccirc{\belnapsignature} / \mathcal{X}\).
\end{lemma}
\begin{proof}
    This follows for the combinational base cases by applying
    \((\andforkeqn)\), \((\orforkeqn)\), \((\notforkeqn)\) and
    \((\joinforkeqn)\).
    Now consider the base case for \(
    \iltikzfig{circuits/algebraic/fork-infinite-register}
    \).
\end{proof}

\begin{proposition}\label{prop:exploded-belnap}
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
    \), there exists essentially combinational Belnap circuits \(
    \iltikzfig{strings/category/f}[box=f_0,dom=4m,cod=1,colour=seq]
    \) and \(
    \iltikzfig{strings/category/f}[box=f_1,dom=4m,cod=1,colour=seq]
    \) containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators, such that \[
        \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
        =
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form}[box=f,dom=m,cod=1].
    \]
\end{proposition}
\begin{proof}
    First let us consider when \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is fully combinational.
    If it is just the identity, then it can be transformed into the desired form
    with
    \((\belnapexpeqn)\).
    Since \(\iltikzfig{strings/category/f}[box=f,colour=comb]\) has codomain
    \(1\) it cannot be a symmetry.
    For the other generators, \((\belnapexpeqn)\) can first be
    applied to the output wire to create the exploded `skeleton'.
    The \(
    \iltikzfig{circuits/components/gates/and}
    \), \(
    \iltikzfig{circuits/components/gates/or}
    \), and \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators can then be pushed inside using the other equations in
    \cref{fig:explosion-equations}.
    A similar principle holds for \(
    \iltikzfig{circuits/components/gates/not}
    \), although as the negation `flips' the translators using
    \((\demorganand)\) and \((\demorganor)\), \((\forkcommeqn)\) must be used to
    restore the correct order of gates, and \((\dneeqn)\) used to eliminate the
    additional \(\iltikzfig{circuits/components/gates/not}\) gates.

    Since \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) may not be fully combinational but \emph{essentially} combinational, it
    may contain \(
    \iltikzfig{circuits/components/waveforms/infinite-register}
    \) subcircuits.
    However, we do not need to worry about these, as we only need translators
    for each input wire; since \(
    \iltikzfig{circuits/components/waveforms/infinite-register}
    \) is closed no translators are required, and hence no equations on

    For composition, we assume that we have
    so we have \[
        \iltikzfig{circuits/axioms/belnap/translation/exploded-composition}.
    \]
    By \cref{lem:explode-copy}, the first circuit can be propagated across
    the forks at the start of the second circuit.
    This means that each of the four `translators' has as input a copy of the
    first circuit.
    Using the same strategy as for the base case the components of the circuit
    can then be propagated across the translators.
    To complete the proof we need to ensure there is exactly one of each
    translator.
    Duplicates are handled by \cref{lem:explode-copy}.
    When propagating the \(
    \iltikzfig{circuits/components/gates/not}
    \) component from the second and third branch of the first circuit across,
    the \(
    \iltikzfig{circuits/components/gates/and}
    \) and \(
    \iltikzfig{circuits/components/gates/or}
    \) components will be switched.
    However, since the same circuit is propagated across each branch of the
    second circuit, the same
    flip will happen in reverse elsewhere.
    Therefore the eventual circuit will be in the correct form.

    For tensor, the circuits can be interleaved using axioms of STMCs.
\end{proof}

This form already looks very similar to a circuit in the image of
\(\mealytofunc\) in that it is the join of two circuits prefixed by
`translators'.
However, these two circuits are not necessarily in the correct form specified by
\(\mealytofunc\).

\begin{definition}[Conjunction]
    A Belnap circuit is a \emph{conjunction} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunction}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is another conjunction.
\end{definition}

\begin{definition}[Disjunction]
    A Belnap circuit is a \emph{disjunction} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnapfalse]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/disjunction}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is another disjunction.
\end{definition}

\begin{definition}[Conjunctive normal form]
    A Belnap circuit is in \emph{conjunctive normal form} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunctive-normal}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is in conjunctive normal form and \(
    \iltikzfig{strings/category/f}[box=g, colour=seq]
    \) is a disjunction.
\end{definition}

\begin{definition}[Disjunctive normal form]
    A Belnap circuit is in \emph{disjunctive normal form} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunctive-normal}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is in disjunctive normal form and \(
    \iltikzfig{strings/category/f}[box=g, colour=seq]
    \) is a conjunction.
\end{definition}

The equations required to bring circuits into conjunctive or disjunctive normal
form are standard.

\begin{definition}
    Let \(\mathcal{F}\) be defined as the set of \emph{normal form equations}
    listed in \cref{fig:normal-form-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/normal-form-equations}

We will now show that these equations suffice to translate a

\begin{lemma}\label{lem:or-normalising}
    Given a combinational circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \) containing only \(
    \iltikzfig{circuits/components/gates/or}
    \) components and structural generators, there exists a circuit
    \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=m,cod=mn]
    \) containing only structural generators and a circuit
    \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) containing only identities and \(
    \iltikzfig{circuits/components/gates/or}
    \) components such that \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) is the tensor of \(n\) circuits \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=m,cod=1]
    \) and \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{strings/category/composition}[box1=g,box2=h,colour=comb]
    \) by equations in \(\mathcal{F}\).
\end{lemma}
\begin{proof}
    Repeatedly applying \((\orforkeqn)\) to \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \)propagates the \(
    \iltikzfig{circuits/components/gates/or}
    \) components as far to the right
    as possible.
    This divides \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \) into several parts: \(n\) parallel circuits \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=p_0,cod=n]
    \) containing just identities and \(
    \iltikzfig{circuits/components/gates/or}
    \) components, and a circuit \(
    \iltikzfig{strings/category/f}[box=g_0,colour=comb,dom=m,cod={\Sigma_{i<n}\ p_i}]
    \) containing only structural generators.
    \[
        \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
        =
        \iltikzfig{circuits/algebraic/belnap-after-copying}
    \]
    Each of these circuits is not guaranteed to have domain \(m\); some of the
    input wires may not be used or may be used more than once.
    By using \((\forkcommeqn)\), \((\forkassoceqn)\), and \((\forkuniteqn)\) to
    manipulate the forks in \(
    \iltikzfig{strings/category/f}[box=g_0,colour=comb]
    \)
    we get that \[
        \iltikzfig{circuits/algebraic/belnap-after-copying}
        =
        \iltikzfig{circuits/algebraic/belnap-rearrange-forks}
    \] where each \(
    \iltikzfig{strings/category/f}[box=k_i,colour=comb,dom=m,cod=p_i]
    \) contains only structural generators.
    Due to the idempotency of \(\lor\), we know that in a disjunction
    \(x_0 \lor x_1 \lor \dots \lor x_{n-1}\), any duplicate variables can
    be removed.
    Since \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=m,cod=1]
    \) only contains identities and \(
    \iltikzfig{circuits/components/gates/or}
    \) gates, this can be replicated syntactically
    using the \((\oridemeqn)\) equation; to translate the circuit into a form
    where this can be applied requires the use of the \((\forkcommeqn)\),
    \((\forkassoceqn)\), \((\orassoc)\) and \((\orcomm)\) equations.

    By repeating this for each subcircuit \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=m,cod=1]
    \), the proof is completed.
\end{proof}

\begin{example}
    \todo[inline]{Example}
\end{example}

\begin{proposition}\label{prop:conjunctive-normal-form}
    Let \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) be an essentially combinational Belnap circuit containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators.
    Then there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) containing only structural generators, a Belnap circuit \(
    \iltikzfig{strings/category/f-2-1}[box=h,colour=comb,dom1=x,dom2=m,cod=n]
    \) in conjunctive normal form, and values \(\listvar{v} \in \valuetuple{x}\)
    such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{circuits/algebraic/belnap-normal}[box1=g,box2=h,val=\listvar{v}]
    \) in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    As \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is essentially combinational, it can be written in the form \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f^\prime]
    \).
    By applying repeatedly \((\andorddisteqn)\), the combinational circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) can then be translated into a conjunction of circuits.
    These circuits will only contain \(
    \iltikzfig{circuits/components/gates/or}
    \) components, so the remainder of the proof follows by
    \cref{lem:or-normalising}.
\end{proof}

The above results apply to circuits in conjunctive normal form, but with some
simple tweaks they can be used for disjunctive normal form as well.

\begin{lemma}\label{lem:and-normalising}
    Given a combinational circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \) containing only \(
    \iltikzfig{circuits/components/gates/and}
    \) components and structural generators, there exists a circuit
    \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=m,cod=mn]
    \) containing only structural generators, and a circuit
    \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) containing only identities and \(
    \iltikzfig{circuits/components/gates/and}
    \) components such that \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) is the tensor of \(n\) circuits \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=m,cod=1]
    \) and \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{strings/category/composition}[box1=g,box2=h,colour=comb]
    \) by equations in \(\mathcal{F}\).
\end{lemma}
\begin{proof}
    As \cref{lem:or-normalising}, but by using the \(\andgate\) version of the
    relevant equations, i.e.\ \((\andforkeqn)\), \((\andassoc)\) and \((\andidemeqn)\).
\end{proof}

\begin{proposition}\label{prop:disjunctive-normal-form}
    Let \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) be an essentially combinational Belnap circuit containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators.
    Then there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) containing only structural generators, a Belnap circuit \(
    \iltikzfig{strings/category/f-2-1}[box=h,colour=comb,dom1=x,dom2=m,cod=n]
    \) in disjunctive normal form, and values \(\listvar{v} \in \valuetuple{x}\)
    such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{circuits/algebraic/belnap-normal}[box1=g,box2=h,val=\listvar{v}]
    \) in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    As \cref{prop:conjunctive-normal-form}, but using \((\andorddisteqn)\) and
    applying \cref{lem:and-normalising} to the result.
\end{proof}

Putting this all together gives us the desired canonical form theorem.

\begin{theorem}
    Let \(
    \morph{\mealytofunc_\belnap}{\func{\interpretation_{\belnap}}}{\ccirc{\Sigma_\belnap}}
    \) be a map induced by functional completeness of the Belnap interpretation
    in the previous section.
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \), there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in the image of \(\mealytofunc_\belnap\) such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in \(\ccirc{\Sigma_\belnap} / \mathcal{X} + \mathcal{F}\).
\end{theorem}
\begin{proof}
    \cref{prop:exploded-belnap}, \cref{prop:conjunctive-normal-form},
    \cref{prop:disjunctive-normal-form} can be applied in
    sequence to create a circuit of the correct form.
    By using \((\forkuniteqn\), \(\forkassoceqn\) and \(\forkcommeqn)\) the
    initial construct of forks and symmetries can be adjusted until it in the
    image of \(\mealytofunc_\belnap\), however it was initially defined.
\end{proof}
