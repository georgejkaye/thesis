\section{Algebraic semantics for Belnap logic}\label{sec:algebraic-belnap}

For a sound and complete equational theory, equations are required to bring any
essentially combinational circuit into a canonical form; it is instructive to
illustrate the equations required for the Belnap interpretation to be
normalisable.

Recall from \cref{sec:denotational-belnap} that the canonical form for circuits
using components in the Belnap signature \(\belnapsignature\) is a circuit that
`explodes' its inputs into two circuits computing the `falsy' and the `truthy'
components of the output, before joining these together.

Since this form is a variation of the standard disjunctive normal form for
Boolean circuits, most of the equations required here should be familiar.

\begin{definition}
    Let the set \(\mathcal{X}\) of \emph{explosion equations} be defined as
    in \cref{fig:explosion-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/explode-equations}

Most of the equations in \(\mathcal{X}\) are well-known; the only interesting
one is \((\belnapexpeqn)\).
This says that we can always `explode' a wire into (trivial) falsy and truthy
subcircuits before joining them back together.
While on its own this may not seem very useful, when combined with the other
equations it sets the stage for translating an entire circuit into an exploded
form.

\begin{lemma}
    The equations in \cref{fig:explosion-equations} are sound.
\end{lemma}
\begin{proof}
    By checking all the inputs.
\end{proof}

The purpose of the explosion equations is to translate any circuit into an
exploded form.
Broadly, the strategy here is to use the \((\belnapexpeqn)\) equation to
introduce an empty explosion on the right of a circuit, then use the remaining
equations to push the components of the original circuit inside the explosion.
The first thing to do is to propagate essentially
combinational circuit components across the opening forks of the explosion.

\begin{lemma}\label{lem:explode-copy}
    For any essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=n,colour=seq]
    \), the equation \(
    \iltikzfig{strings/structure/cartesian/naturality-copy-lhs}[colour=comb,box=f]
    =
    \iltikzfig{strings/structure/cartesian/naturality-copy-rhs}[colour=comb,box=f]
    \) in \(\scirc{\belnapsignature} / \mathcal{X}\).
\end{lemma}
\begin{proof}
    This follows for the combinational generators by applying
    \((\joinforkeqn)\), \((\botforkeqn)\), \((\andforkeqn)\), \((\orforkeqn)\),
    \((\notforkeqn)\), and is immediate for the fork.
    The infinite register \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=v]
    \) is also a base case and is covered by \((\infregforkeqn)\).
    The inductive cases are trivial.
\end{proof}

\begin{proposition}\label{prop:exploded-belnap}
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
    \), there exists combinational Belnap circuits \(
    \iltikzfig{strings/category/f-3-1}[box=f_0,dom1=1,dom2=m,dom3=m,cod=1,colour=comb]
    \) and \(
    \iltikzfig{strings/category/f-3-1}[box=f_1,dom1=1,dom2=m,dom3=m,cod=1,colour=comb]
    \) containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators, such that \[
        \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
        =
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form}[box=f,dom=m,cod=1].
    \]
\end{proposition}
\begin{proof}
    First we consider the base cases.
    If \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is the identity, then it can be transformed into the desired form
    with
    \((\belnapexpeqn)\).
    Since \(\iltikzfig{strings/category/f}[box=f,colour=seq]\) has codomain
    \(1\) it cannot be a symmetry.
    For the other generators and the infinite register,
    \((\belnapexpeqn)\) can be applied to the output wire to create the
    exploded `skeleton', followed by using \cref{lem:explode-copy} to copy the
    components into four.
    The four copies can be pushed through the translators
    using \((\joinforkeqn)\), \((\joinandeqn)\), \((\joinoreqn)\),
    \((\botforkeqn)\), \((\botoreqn)\) \((\andcomm)\), \((\orcomm)\),
    \((\andorddisteqn)\), \((\oranddisteqn)\), \((\infregandeqn)\),
    \((\infregoreqn)\), \((\infregnoteqn)\), \((\demorganand)\),
    \((\demorganor)\), \((\botnoteqn)\), \((\botandeqn)\), and \((\botoreqn)\).
    As propagating the \(
    \iltikzfig{circuits/components/gates/not}
    \) flips the translators by using \((\demorganand)\) and \((\demorganor)\),
    \((\forkcommeqn)\) must be used to restore the correct order, and
    \((\dneeqn)\) is used to eliminate additional
    \(\iltikzfig{circuits/components/gates/not}\) gates.
    Any infinite registers containing \(\bot\) can be converted to
    \(\iltikzfig{strings/structure/monoid/init}[colour=comb]\) components using
    \((\botregeqn)\), and other registers can be combined using
    \((\infregforkeqn)\).

    For the composition inductive case, we have two exploded circuits and we
    need to push the first inside the second.
    Using \cref{lem:explode-copy}, the first circuit can be propagated across
    the forks at the start of the second, so each of the four translators has as
    input a copy of the first circuit.
    Using the same strategy as for the base case the components of the circuit
    can then be propagated across the translators.
    For tensor, the circuits can be interleaved using axioms of STMCs.
\end{proof}

This form already looks very similar to a circuit in the image of
\(\mealytofunc_\belnap\) in that it is the join of two circuits prefixed by
`translators'.
These two circuits are not necessarily in the correct form specified by
\(\mealytofunc_\belnap\), as they must be in \emph{truthy} or \emph{falsy}
disjunctive normal form.
The equations required to bring circuits into such a form are
relatively standard.

\begin{definition}
    Let \(\mathcal{F}\) be defined as the set of \emph{normal form equations}
    listed in \cref{fig:normal-form-equations}.
\end{definition}

\begin{lemma}
    The normal form equations are sound.
\end{lemma}
\begin{proof}
    By checking all the inputs.
\end{proof}

\input{sections/semantics/algebraic/floats/normal-form-equations}

We will now show that these equations suffice to translate the subcircuits in
the exploded circuit into falsy or truthy disjunctive normal form.
First we will consider the case for the truthy circuit; we need to show that
the equations in \(\mathcal{F}\) can translate the circuit into a construct of
forks composed with a circuit in truthy disjunctive normal form.

\begin{lemma}\label{lem:truthy-conjunction-normalising}
    Given a Belnap circuit \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f,dom=m,cod=n,values=\belnaptrue]
    \) containing no \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \), \(
    \iltikzfig{circuits/components/gates/or}
    \) or \(
    \iltikzfig{circuits/components/gates/not}
    \) components, there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=mn,cod=p]
    \) containing only identity and elimination constructs, and a circuit \(
    \iltikzfig{strings/category/f}[box=h,colour=seq,dom=p,cod=n]
    \) defined as the tensor of \(n\) truthy conjunctions, such that \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f,dom=m,cod=n,values=\belnaptrue]
    =
    \iltikzfig{circuits/algebraic/unction-circuit}
    \) in \(\scirc{\belnapsignature} / \mathcal{F}\).
\end{lemma}
\begin{proof}
    Repeatedly applying \((\andforkeqn)\) to \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    \) propagates the \(
    \iltikzfig{circuits/components/gates/and}
    \) components in the circuit as far to the right as possible, so all the
    fork and eliminate constructs are all in the left half of the term.
    Using \((\forkcommeqn)\), \((\forkassoceqn)\) to rearrange the forks, and
    \((\forkuniteqn)\) to introduce forks where necessary,
    we can manipulate these forks such that there is a wire for each of the \(m\)
    inputs feeds into each of the \(n\) outputs.
    Similarly, we can use \((\andideqn)\) to introduce infinite registers where
    appropriate, so we have a circuit of the form below. \[
        \iltikzfig{circuits/algebraic/belnap-rearrange-forks}
    \]
    The subcircuits may not be truthy conjunctions yet, as the input wires may
    be used more than once.
    Using the \((\andidemeqn)\), \((\forkcommeqn)\), \((\forkassoceqn)\),
    \((\andassoc)\) and \((\andcomm)\), each subcircuit can be translated into
    a truthy conjunction.
\end{proof}

\begin{example}
    Consider the circuit \(
    \iltikzfig{circuits/examples/conjunction/step-0}
    \); we transform it into a truthy conjunction as follows.
    \begin{gather*}
        \iltikzfig{circuits/examples/conjunction/step-0}
        \eqaxioms[(\forkuniteqn)]
        \iltikzfig{circuits/examples/conjunction/step-1}
        \eqaxioms[(\forkuniteqn)]
        \iltikzfig{circuits/examples/conjunction/step-2}
        \eqaxioms[(\forkcommeqn)]
        \\
        \iltikzfig{circuits/examples/conjunction/step-3}
        \eqaxioms[(\forkassoceqn)]
        \iltikzfig{circuits/examples/conjunction/step-4}
        \eqaxioms[(\andcomm)]
        \iltikzfig{circuits/examples/conjunction/step-5}
        \eqaxioms[(\andforkeqn)]
        \\
        \iltikzfig{circuits/examples/conjunction/step-6}
        \eqaxioms[(\andassoc)]
        \iltikzfig{circuits/examples/conjunction/step-7}
        \eqaxioms[(\forkassoceqn)]
        \\
        \iltikzfig{circuits/examples/conjunction/step-8}
        \eqaxioms[(\andidemeqn)]
        \iltikzfig{circuits/examples/conjunction/step-9}
        \eqaxioms[(\andassoc)]
        \\
        \iltikzfig{circuits/examples/conjunction/step-10}
        \eqaxioms[(\andcomm)]
        \iltikzfig{circuits/examples/conjunction/step-11}
        \eqaxioms[(\andassoc)]
        \\
        \iltikzfig{circuits/examples/conjunction/step-12}
        \eqaxioms[(\andidemeqn)]
        \iltikzfig{circuits/examples/conjunction/step-13}
        \eqaxioms[(\andassoc)]
        \\
        \iltikzfig{circuits/examples/conjunction/step-14}
        \eqaxioms[(\andidemeqn)]
        \iltikzfig{circuits/examples/conjunction/step-15}
        \eqaxioms
        \iltikzfig{circuits/examples/conjunction/step-16}
        \eqaxioms[(\andideqn)]
        \iltikzfig{circuits/examples/conjunction/step-17}
    \end{gather*}
\end{example}

The proof for the falsy circuit is almost exactly the same.

\begin{lemma}\label{lem:falsy-conjunction-normalising}
    Given a Belnap circuit \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f,dom=m,cod=n,values=\belnaptrue]
    \) containing no \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \), \(
    \iltikzfig{circuits/components/gates/and}
    \) or \(
    \iltikzfig{circuits/components/gates/not}
    \) components, there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=mn,cod=p]
    \) containing only identity and elimination constructs, and a circuit \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=p,cod=n]
    \) defined as the tensor of \(n\) falsy conjunctions, such that \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{circuits/algebraic/unction-circuit}
    \) in \(\scirc{\belnapsignature} / \mathcal{F}\).
\end{lemma}
\begin{proof}
    As \cref{lem:truthy-conjunction-normalising}, but with the equations
    on \(\iltikzfig{circuits/components/gates/or}\) components.
\end{proof}

Truthy and falsy conjunctions can then be used to create truthy and falsy
conjunctive normal forms.

\begin{proposition}\label{prop:disjunctive-normal-form}
    Given a Belnap circuit \[
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form}[box=f,dom=m,cod=1]
    \] in which \(
    \iltikzfig{strings/category/f-3-1}[box=f_0,colour=comb]
    \) and \(
    \iltikzfig{strings/category/f-3-1}[box=f_1,colour=comb]
    \) contain no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators, there exists a circuit \[
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form-cnf}[box=f,dom=m,cod=1]
    \] in which \(
    \iltikzfig{strings/category/f}[box=g_0,colour=comb]
    \) and \(
    \iltikzfig{strings/category/f}[box=g_1,colour=comb]
    \) contain only identity and elimination components,
    \(
    \iltikzfig{strings/category/f}[box=h_0,colour=seq]
    \) is in falsy conjunctive normal form and\(
    \iltikzfig{strings/category/f}[box=h_1,colour=seq]
    \) is in truthy conjunctive normal form, such that \[
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form}[box=f]
        =
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form-cnf}
    \] in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    First, all the \(
    \iltikzfig{circuits/components/gates/and}
    \) components need to be propagated to the far right of the \(
    \iltikzfig{strings/category/f-3-1}[box=f_0,colour=comb]
    \) circuit using \((\oranddisteqn)\), and all the \(
    \iltikzfig{circuits/components/gates/or}
    \) components need to be propagated to the far right of the \(
    \iltikzfig{strings/category/f-3-1}[box=f_1,colour=comb]
    \) circuit using \((\andorddisteqn)\).
    This means that the circuits are split into two halves, each containing
    one type of gate.

    For these circuits to be in truthy or falsy conjunctive normal form, they
    need to contain exactly one \(
    \iltikzfig{strings/structure/monoid/init}[colour=comb]
    \) component to act as the conjunctive unit.
    If there is not already such a component inside the \(
    \iltikzfig{strings/category/f-3-1}[box=f_0,colour=comb]
    \) or \(
    \iltikzfig{strings/category/f-3-1}[box=f_1,colour=comb]
    \) subcircuits, one can be inserted using the \((\botanduniteqn)\) equation
    for the former and the \((\botoruniteqn)\) equation for the latter.
    If there are multiple unit components, these can be propagated through the
    circuit using \((\orassoc)\), \((\oranddisteqn)\), \((\andassoc)\), and
    \((\andorddisteqn)\), and combined into one by using \((\botandeqn)\) or
    \((\botoreqn)\).

    Now we have circuits that have the `root' of disjunctive normal forms, but
    the `leaves' are not conjunctions.
    This is remedied by applying \cref{lem:truthy-conjunction-normalising} and
    \cref{lem:falsy-conjunction-normalising} to the left half of each circuit.
\end{proof}

Putting this all together gives us the desired canonical form theorem.

\begin{theorem}
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \), there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in the image of \(\mealytofunc_\belnap\) such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in \(\ccirc{\Sigma_\belnap} / \mathcal{X} + \mathcal{F}\).
\end{theorem}
\begin{proof}
    This follows by applying \cref{prop:exploded-belnap} followed by
    \cref{prop:disjunctive-normal-form}.
\end{proof}

This shows that the equations detailed in this section can translate any
essentially combinational circuit in \(\scirc{\belnapinterpretation}\) to one in
the image of the Belnap functional completeness map.