\section{Algebraic semantics for Belnap logic}\label{sec:algebraic-belnap}

For a sound and complete equational theory, equations are required to bring any
essentially combinational circuit into a canonical form.
Recall from \cref{sec:denotational-belnap} that the canonical form for circuits
using components in the Belnap signature \(\belnapsignature\) is a circuit that
`explodes' its inputs into two circuits computing the `falsy' and the `truthy'
components of the output, before joining these together.

Since this form is a variation of the standard disjunctive normal form for
Boolean circuits, most of the equations required here should be familiar.

\begin{definition}
    Let the set \(\mathcal{X}\) of \emph{explosion equations} be defined as
    in \cref{fig:explosion-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/explode-equations}

Most of the equations in \(\mathcal{X}\) are well-known; the only interesting
one is \((\belnapexpeqn)\).
This says that we can always `explode' a wire into (trivial) falsy and truthy
subcircuits before joining them back together.
While on its own this may not seem very useful, when combined with the other
equations it sets the stage for translating an entire circuit into an exploded
form.

\begin{lemma}
    The equations in \cref{fig:explosion-equations} are sound.
\end{lemma}
\begin{proof}
    By checking all the inputs.
\end{proof}

The purpose of the explosion equations is to translate any circuit into an
exploded form.
Broadly, the strategy here is to use the \((\belnapexpeqn)\) equation to
introduce an empty explosion on the right of a circuit, then use the remaining
equations to push the components of the original circuit inside the explosion.
The first thing to do, then, is to be able to propagate essentially
combinational circuit components across the opening forks of the explosion.

\begin{lemma}\label{lem:explode-copy}
    For any essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=n,colour=seq]
    \), the equation \(
    \iltikzfig{strings/structure/cartesian/naturality-copy-lhs}[colour=comb,box=f]
    =
    \iltikzfig{strings/structure/cartesian/naturality-copy-rhs}[colour=comb,box=f]
    \) in \(\scirc{\belnapsignature} / \mathcal{X}\).
\end{lemma}
\begin{proof}
    This follows for the combinational generators by applying
    \((\andforkeqn)\), \((\orforkeqn)\), \((\notforkeqn)\) and
    \((\joinforkeqn)\), and is immediate for the fork.
    The infinite register \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=v]
    \) can also be treated as a base case and is covered by \((\infregforkeqn)\).
    The inductive cases are then trivial.
\end{proof}

\begin{proposition}\label{prop:exploded-belnap}
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
    \), there exists essentially combinational Belnap circuits \(
    \iltikzfig{strings/category/f}[box=f_0,dom=4m,cod=1,colour=seq]
    \) and \(
    \iltikzfig{strings/category/f}[box=f_1,dom=4m,cod=1,colour=seq]
    \) containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators, such that \[
        \iltikzfig{strings/category/f}[box=f,dom=m,cod=1,colour=seq]
        =
        \iltikzfig{circuits/axioms/belnap/translation/exploded-form}[box=f,dom=m,cod=1].
    \]
\end{proposition}
\begin{proof}
    First let us consider when \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is truly combinational, i.e.\ it contains no constant registers.
    If it is just the identity, then it can be transformed into the desired form
    with
    \((\belnapexpeqn)\).
    Since \(\iltikzfig{strings/category/f}[box=f,colour=comb]\) has codomain
    \(1\) it cannot be a symmetry.
    For the other generators, \((\belnapexpeqn)\) can first be
    applied to the output wire to create the exploded `skeleton'.
    The \(
    \iltikzfig{circuits/components/gates/and}
    \), \(
    \iltikzfig{circuits/components/gates/or}
    \), and \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators can then be pushed inside using the other equations in
    \cref{fig:explosion-equations}.
    A similar principle holds for \(
    \iltikzfig{circuits/components/gates/not}
    \), although as the negation `flips' the translators using
    \((\demorganand)\) and \((\demorganor)\), \((\forkcommeqn)\) must be used to
    restore the correct order of gates, and \((\dneeqn)\) used to eliminate the
    additional \(\iltikzfig{circuits/components/gates/not}\) gates.

    Since \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is \emph{essentially} combinational, it may contain \(
    \iltikzfig{circuits/components/waveforms/infinite-register}
    \) subcircuits.
    Other than the equation to copy the infinite register construct, no
    additional equations are needed: since we only
    need to translate open inputs, the translator connected to the infinite
    register becomes part of the exploded circuit.

    For composition, we assume that we have
    so we have \[
        \iltikzfig{circuits/axioms/belnap/translation/exploded-composition}.
    \]
    By \cref{lem:explode-copy}, the first circuit can be propagated across
    the forks at the start of the second circuit.
    This means that each of the four `translators' has as input a copy of the
    first circuit.
    Using the same strategy as for the base case the components of the circuit
    can then be propagated across the translators.
    To complete the proof we need to ensure there is exactly one of each
    translator.
    Duplicates are handled by \cref{lem:explode-copy}.
    When propagating the \(
    \iltikzfig{circuits/components/gates/not}
    \) component from the second and third branch of the first circuit across,
    the \(
    \iltikzfig{circuits/components/gates/and}
    \) and \(
    \iltikzfig{circuits/components/gates/or}
    \) components will be switched.
    However, since the same circuit is propagated across each branch of the
    second circuit, the same
    flip will happen in reverse elsewhere.
    Therefore the eventual circuit will be in the correct form.

    For tensor, the circuits can be interleaved using axioms of STMCs.
\end{proof}

This form already looks very similar to a circuit in the image of
\(\mealytofunc\) in that it is the join of two circuits prefixed by
`translators'.
However, these two circuits are not necessarily in the correct form specified by
\(\mealytofunc\).
The canonical form of two of the exploded subcircuits is that of
\emph{conjunctive normal form}.

\begin{definition}[Disjunction]
    A Belnap circuit is a \emph{disjunction} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnapfalse]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/disjunction}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is another disjunction.
\end{definition}

\begin{definition}[Conjunctive normal form]
    A Belnap circuit is in \emph{conjunctive normal form} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunctive-normal}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is in conjunctive normal form and \(
    \iltikzfig{strings/category/f}[box=g, colour=seq]
    \) is a disjunction.
\end{definition}

For the other two exploded subcircuits, the canonical circuits are in
\emph{disjunctive normal form}.

\begin{definition}[Conjunction]
    A Belnap circuit is a \emph{conjunction} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunction}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is another conjunction.
\end{definition}

\begin{definition}[Disjunctive normal form]
    A Belnap circuit is in \emph{disjunctive normal form} if it is \(
    \iltikzfig{circuits/components/waveforms/infinite-register}[val=\belnaptrue]
    \) or of the form \(
    \iltikzfig{circuits/algebraic/conjunctive-normal}
    \), where \(
    \iltikzfig{strings/category/f}[box=f, colour=seq]
    \) is in disjunctive normal form and \(
    \iltikzfig{strings/category/f}[box=g, colour=seq]
    \) is a conjunction.
\end{definition}

The equations required to bring circuits into conjunctive or disjunctive normal
form are standard.

\begin{definition}
    Let \(\mathcal{F}\) be defined as the set of \emph{normal form equations}
    listed in \cref{fig:normal-form-equations}.
\end{definition}

\input{sections/semantics/algebraic/floats/normal-form-equations}

We will now show that these equations suffice to translate the subcircuits in
the exploded circuit into conjunctive or disjunctive normal form.
To do this, we will use some notation for composite forks.

\begin{definition}\label{def:mk-fork}
    For \(n \in \nat\), an \emph{\(m,k\)-fork}
    \(\iltikzfig{circuits/components/structural/mn-fork}\)
    is defined
    inductively with \(
    \iltikzfig{circuits/components/structural/m0-fork} \coloneqq
    \iltikzfig{strings/category/identity-blank}[obj=m]
    \) and \(
    \iltikzfig{circuits/components/structural/mkp1-fork} \coloneqq
    \iltikzfig{circuits/components/structural/n-fork}
    \).
\end{definition}

First we consider disjunctive normal form; to this end we will need to translate
a circuit of \(\iltikzfig{circuits/components/gates/and}\) components into a
conjunction.

\begin{lemma}\label{lem:conjunction-normalising}
    Given a combinational circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \) containing no \(
    \iltikzfig{circuits/components/gates/or}
    \) or \(
    \iltikzfig{circuits/components/gates/not}
    \) components, there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=mn,cod=n]
    \) which is the tensor of \(n\) disjunctions such that \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{circuits/algebraic/unction-circuit}
    \) in \(\scirc{\belnapsignature} / \mathcal{F}\).
\end{lemma}
\begin{proof}
    Repeatedly applying \((\andforkeqn)\) to \(
    \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
    \) propagates the \(
    \iltikzfig{circuits/components/gates/and}
    \) components as far to the right
    as possible.
    This divides \(
    \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
    \) into several parts: \(n\) parallel circuits \(
    \iltikzfig{strings/category/f}[box=h_i,colour=seq,dom=p_0,cod=n]
    \) containing identities and \(
    \iltikzfig{circuits/components/gates/or}
    \) components, and potentially infinite registers, and a circuit \(
    \iltikzfig{strings/category/f}[box=g_0,colour=comb,dom=m,cod={\Sigma_{i<n}\ p_i}]
    \) containing only structural generators.
    \[
        \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
        =
        \iltikzfig{circuits/algebraic/belnap-after-copying}
    \]
    By using \((\forkcommeqn)\), \((\forkassoceqn)\) and \((\forkuniteqn)\),
    we can translate the circuit such that each of the \(m\) input wires forks
    into each `branch', even if it is immediately eliminated.
    Again by \((\forkcommeqn)\) and \((\forkassoceqn)\), these forks can be
    brought to the form of \cref{def:mk-fork}.
    This means we have \[
        \iltikzfig{circuits/algebraic/belnap-after-copying}
        =
        \iltikzfig{circuits/algebraic/belnap-rearrange-forks}
    \]
    In a conjunction \(x_0 \land x_1 \land \dots \land x_{n-1}\), any duplicate
    variables can be removed due to idempotency.
    This can be replicated syntactically using the \((\andidemeqn)\) equation;
    to translate the circuit into a form where this can be applied may
    additionally require the use of the \((\forkcommeqn)\), \((\forkassoceqn)\),
    \((\andassoc)\) and \((\andcomm)\) equations.

    Finally, if the infinite register required in a conjunction is not present,
    we introduce it using the \((\andideqn)\) equation.

    By repeating this for each subcircuit \(
    \iltikzfig{strings/category/f}[box=h_i,colour=comb,dom=m,cod=1]
    \), the proof is completed.
\end{proof}

\begin{example}
    \todo[inline]{Example}
\end{example}

Now that we can create disjunctions, we are able to create a circuit in
conjunctive normal form.

\begin{proposition}\label{prop:conjunctive-normal-form}
    Let \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) be an essentially combinational Belnap circuit containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators.
    Then there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) containing only structural generators, a Belnap circuit \(
    \iltikzfig{strings/category/f-2-1}[box=h,colour=comb,dom1=x,dom2=m,cod=n]
    \) in conjunctive normal form, and values \(\listvar{v} \in \valuetuple{x}\)
    such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{circuits/algebraic/belnap-normal}[box1=g,box2=h,val=\listvar{v}]
    \) in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    As \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) is essentially combinational, it can be written in the form \(
    \iltikzfig{circuits/synthesis/normalised-function}[box=f^\prime]
    \).
    By applying repeatedly \((\andorddisteqn)\), the combinational circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) can then be translated into a conjunction of circuits.
    These circuits will only contain \(
    \iltikzfig{circuits/components/gates/or}
    \) components, so the remainder of the proof follows by
    \cref{lem:or-normalising}.
\end{proof}

The above results apply to circuits in conjunctive normal form, but with some
simple tweaks they can be used for disjunctive normal form as well.

\begin{lemma}\label{lem:and-normalising}
    Given an essentially combinational circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=comb,dom=m,cod=n]
    \) containing only registers, \(
    \iltikzfig{circuits/components/gates/and}
    \) components, there exists a circuit
    \(
    \iltikzfig{strings/category/f}[box=g,colour=comb,dom=m,cod=mn]
    \) containing only structural generators, and a circuit
    \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) containing only identities and \(
    \iltikzfig{circuits/components/gates/and}
    \) components such that \(
    \iltikzfig{strings/category/f}[box=h,colour=comb,dom=mn,cod=n]
    \) is the tensor of \(n\) disjunctions \(
    \iltikzfig{strings/category/f}[box=h_i,colour=seq,dom=m,cod=1]
    \), and \(
    \iltikzfig{strings/category/f}[box=f,colour=comb]
    =
    \iltikzfig{strings/category/composition}[box1=g,box2=h,colour=comb]
    \) by equations in \(\mathcal{F}\).
\end{lemma}
\begin{proof}
    As \cref{lem:or-normalising}, but by using the \(\andgate\) version of the
    relevant equations, i.e.\ \((\andforkeqn)\), \((\andassoc)\) and \((\andidemeqn)\).
\end{proof}

\begin{proposition}\label{prop:disjunctive-normal-form}
    Let \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \) be an essentially combinational Belnap circuit containing no \(
    \iltikzfig{circuits/components/gates/not}
    \) or \(
    \iltikzfig{strings/structure/monoid/merge}[colour=comb]
    \) generators.
    Then there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=comb]
    \) containing only structural generators, a Belnap circuit \(
    \iltikzfig{strings/category/f-2-1}[box=h,colour=comb,dom1=x,dom2=m,cod=n]
    \) in disjunctive normal form, and values \(\listvar{v} \in \valuetuple{x}\)
    such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{circuits/algebraic/belnap-normal}[box1=g,box2=h,val=\listvar{v}]
    \) in \(
    \scirc{\belnapsignature} / \mathcal{F}
    \).
\end{proposition}
\begin{proof}
    As \cref{prop:conjunctive-normal-form}, but using \((\andorddisteqn)\) and
    applying \cref{lem:and-normalising} to the result.
\end{proof}

Putting this all together gives us the desired canonical form theorem.

\begin{theorem}
    Let \(
    \morph{\mealytofunc_\belnap}{\func{\interpretation_{\belnap}}}{\ccirc{\Sigma_\belnap}}
    \) be a map induced by functional completeness of the Belnap interpretation
    in the previous section.
    Given an essentially combinational Belnap circuit \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    \), there exists a circuit \(
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in the image of \(\mealytofunc_\belnap\) such that \(
    \iltikzfig{strings/category/f}[box=f,colour=seq]
    =
    \iltikzfig{strings/category/f}[box=g,colour=seq]
    \) in \(\ccirc{\Sigma_\belnap} / \mathcal{X} + \mathcal{F}\).
\end{theorem}
\begin{proof}
    \cref{prop:exploded-belnap}, \cref{prop:conjunctive-normal-form},
    \cref{prop:disjunctive-normal-form} can be applied in
    sequence to create a circuit of the correct form.
    By using \((\forkuniteqn)\), \((\forkassoceqn)\) and \((\forkcommeqn)\) the
    initial construct of forks and symmetries can be adjusted until it in the
    image of \(\mealytofunc_\belnap\), however it was initially defined.
\end{proof}
