\section{Rewriting with commutative comonoid structure}

Hypergraphs are a good fit for rewriting terms in
\(\smcsigma + \frob\) because they allow rewriting modulo
\emph{Frobenius structure}.
We can take advantage of this to rewriting modulo
\emph{cocommutative comonoid} structure on top of the trace.
To do this, the partial monogamy conditions are weakened to
partial \emph{left-}monogamy conditions.

\begin{definition}[Traced left-boundary complement]
    \label{def:traced-left-boundary-complement}
    For partial left-monogamous cospans \(
    \cospan{i}[a_1]{L}[a_2]{j}
    \) and \(
    \cospan{n}[b_1]{G}[b_2]{m} \in \hypsigma
    \), a pushout complement as in \cref{def:traced-boundary-complement}
    is called a \emph{traced left-boundary complement} if \(c_2\)
    is mono and \(
    \cospan{j + m}[[c_2,d_1]]{C}[[c_1,d_2]]{{i + n}}
    \) is a partial left-monogamous cospan.
\end{definition}

\begin{definition}[Traced comonoid DPO]
    For morphisms \(G \leftarrow m+n\) and \(H \leftarrow m+n\) in
    \(\hypsigma\), there is a traced comonoid rewrite \(G \trgrewrite[\mcr] H\)
    if there exists a rule \(
    \spann{L}{i + j}{G} \in \mcr
    \) and cospan \(
    \cospan{i + j}{C}{m + n} \in \hypsigma
    \) such that diagram in \cref{def:dpo-rewriting} commutes and
    \(i + j \to C \to G\) is a
    traced left-boundary complement.
\end{definition}

Just like traced rewriting, there may be multiple traced left-boundary
complements, which arise because we are now absorbing the equations of a
cocommutative comonoid.

\begin{example}
    Consider the following rule and its interpretation.
    \begin{gather*}
        \rrule{
            \iltikzfig{graphs/dpo/non-unique-comonoid/rule-lhs}
        }{
            \iltikzfig{graphs/dpo/non-unique-comonoid/rule-rhs}
        }
        \qquad
        \raisebox{-3em}{\includestandalone{figures/graphs/dpo/non-unique-comonoid/rule}}
    \end{gather*}
    Two valid rewrites of this rule in \(
    \iltikzfig{graphs/dpo/non-unique-comonoid/j}
    \to
    \iltikzfig{graphs/dpo/non-unique-comonoid/g}\) are:
    \begin{gather*}
        \iltikzfig{graphs/dpo/non-unique-comonoid/c1}
        \to
        \iltikzfig{graphs/dpo/non-unique-comonoid/h1}
        \qquad
        \iltikzfig{graphs/dpo/non-unique-comonoid/c2}
        \to
        \iltikzfig{graphs/dpo/non-unique-comonoid/h2}
    \end{gather*}
    The first rewrite is the `obvious' one, but the second also holds by
    cocommutativity:
    \begin{gather*}
        \iltikzfig{graphs/dpo/non-unique-comonoid/rewrite-1}
        =
        \iltikzfig{graphs/dpo/non-unique-comonoid/rewrite-2a}
        \qquad
        \iltikzfig{graphs/dpo/non-unique-comonoid/rewrite-1}
        =
        \iltikzfig{graphs/dpo/non-unique-comonoid/rewrite-2b}
        =
        \iltikzfig{graphs/dpo/non-unique-comonoid/rewrite-3b}
    \end{gather*}
\end{example}

To show the soundness and completeness of traced comonoid rewriting, we follow
the same procedure as in the traced setting.

\begin{theorem}
    Given a rewrite rule \(\rrule{
        \iltikzfig{strings/category/f}[box=l,colour=white]
    }{
        \iltikzfig{strings/category/f}[box=r,colour=white]
    }\) in \(
    \stmcsigma + \ccomon
    \), \(
    \iltikzfig{strings/category/f}[box=g,colour=white]
    \rewrite[\rrule{
            \iltikzfig{strings/category/f}[box=l,colour=white]
        }{
            \iltikzfig{strings/category/f}[box=r,colour=white]
        }]
    \iltikzfig{strings/category/f}[box=h,colour=white]
    \) if and only if \[
        \termandfrobtohypsigma[
            \foldinterfaces[
                \tracedandcomonoidtofrobsigma[
                    \iltikzfig{strings/category/f}[box=g,colour=white]
                ]
            ]
        ]
        \grewrite[
            \termandfrobtohypsigma[
                \rrule{
                    \tracedandcomonoidtofrobsigma[
                        \iltikzfig{strings/category/f}[box=l,colour=white]
                    ]
                }{
                    \tracedandcomonoidtofrobsigma[
                        \iltikzfig{strings/category/f}[box=r,colour=white]
                    ]
                }
            ]
        ]
        \termandfrobtohypsigma[
            \foldinterfaces[
                \iltikzfig{strings/category/f}[box=g,colour=white]
            ]
        ].\]
\end{theorem}
\begin{proof}
    As \cref{thm:traced-rewrite-correspondence}, but with partial left-monogamy
    and traced left-boundary complements.
\end{proof}

This means that we can also safely perform rewriting modulo traced comonoid
structure by building on the machinery used for the traced case.
Predictably, the same also holds for the coloured setting.

\begin{theorem}
    Given a rewrite rule \(\rrule{
        \iltikzfig{strings/category/f}[box=l,colour=white]
    }{
        \iltikzfig{strings/category/f}[box=r,colour=white]
    }\) in \(
    \stmcsigmac + \ccomonc
    \), \(
    \iltikzfig{strings/category/f}[box=g,colour=white]
    \rewrite[\rrule{
            \iltikzfig{strings/category/f}[box=l,colour=white]
        }{
            \iltikzfig{strings/category/f}[box=r,colour=white]
        }]
    \iltikzfig{strings/category/f}[box=h,colour=white]
    \) if and only if \[
        \termandfrobtohypsigmac[
            \foldinterfacesc[
                \tracedandcomonoidtofrobsigmac[
                    \iltikzfig{strings/category/f}[box=g,colour=white]
                ]
            ]
        ]
        \grewrite[
            \termandfrobtohypsigmac[
                \rrule{
                    \tracedandcomonoidtofrobsigmac[
                        \iltikzfig{strings/category/f}[box=l,colour=white]
                    ]
                }{
                    \tracedandcomonoidtofrobsigmac[
                        \iltikzfig{strings/category/f}[box=r,colour=white]
                    ]
                }
            ]
        ]
        \termandfrobtohypsigmac[
            \foldinterfacesc[
                \iltikzfig{strings/category/f}[box=g,colour=white]
            ]
        ].\]
\end{theorem}