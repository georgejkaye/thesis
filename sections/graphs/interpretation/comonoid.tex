\section{Hypergraphs for traced comonoid terms}

\begin{figure}
    \centering
    \includestandalone{figures/graphs/roadmap}
    \caption{Interactions between categories of terms and hypergraphs}
    \label{fig:graph-roadmap}
\end{figure}

By characterising the cospans of hypergraphs that correspond to \emph{traced}
terms, we already have a setting in which we can model sequential circuit
morphisms combinatorially.
But why stop there?
When modelling \emph{Frobenius} terms, we were modelling them modulo the
Frobenius \emph{equations}; when interpreted as cospans of hypergraphs the
comonoid and monoid structures merge together into single vertices so we do not
need to consider the equations of associativity, commutativity or unitality.

In the realm of sequential circuits we also have monoid and comonoid structures,
but instead of forming a Frobenius structure they only form a \emph{bialgebra}.
The equations of a bialgebra are different to those of a Frobenius algebra in
how the monoid and comonoid interact.
Compare the two Frobenius equations with the bialgebra equation shown below:
\[
    \equationdisplay{
        \iltikzfig{strings/structure/bialgebra/merge-copy-lhs}
    }{
        \iltikzfig{strings/structure/frobenius/frobenius-l}
    }{
        \frobleqn
    }
    \qquad
    \equationdisplay{
        \iltikzfig{strings/structure/bialgebra/merge-copy-lhs}
    }{
        \iltikzfig{strings/structure/frobenius/frobenius-r}
    }{
        \frobreqn
    }
    \qquad\qquad
    \equationdisplay{
        \iltikzfig{strings/structure/bialgebra/merge-copy-lhs}
    }{
        \iltikzfig{strings/structure/frobenius/frobenius-r}
    }{
        \bialgcommoneqn
    }
\]
When operating in a Frobenius setting, it is possible to derive the bialgebra
equation \(\bialgcommoneqn\) from the Frobenius equations combined with the
equations of monoids and comonoids.

\begin{lemma}
    In \(\hypcsigma\), \(
    \iltikzfig{strings/structure/bialgebra/merge-copy-rhs}
    =
    \iltikzfig{strings/structure/bialgebra/merge-copy-lhs}
    \).
\end{lemma}
\begin{proof}
    \begin{gather*}
        \iltikzfig{strings/structure/bialgebra/merge-copy-rhs}
        \eqaxioms
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-1}
        \eqaxioms[\comonoidcommeqn]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-2}
        \eqaxioms[\frobreqn]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-3}
        \eqaxioms[\frobleqn]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-4}
        \eqaxioms[\monoidassoceqn]
        \\[0.5em]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-5}
        \eqaxioms[\monoidcommeqn]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-6}
        \eqaxioms[\frobleqn]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-7}
        \eqaxioms[\frobspeceqn]
        \iltikzfig{strings/structure/bialgebra/frobenius-bialgebra/step-8}
    \end{gather*}
\end{proof}

Indeed, this is clear from the hypergraph interpretation, as all four terms
involved map to the same (discrete) cospan of hypergraphs.
%
\begin{gather*}
    \frobtohypsigma[
        \iltikzfig{strings/structure/frobenius/frobenius-l}
    ]
    \,
    =
    \,
    \frobtohypsigma[
        \iltikzfig{strings/structure/frobenius/frobenius-r}
    ]
    \,
    =
    \,
    \frobtohypsigma[
        \iltikzfig{strings/structure/bialgebra/merge-copy-lhs}
    ]
    \,
    =
    \,
    \frobtohypsigma[
        \iltikzfig{strings/structure/bialgebra/merge-copy-rhs}
    ]
    \,
    =
    \,
    \iltikzfig{graphs/example-frobenius-collapse}
\end{gather*}

However, the converse does not hold: it is not possible to derive the Frobenius
equations from the bialgebra equation without having one of the Frobenius
equations to begin with!
This poses a problem: we want to use \(\cspdchyp\) as a setting for rewriting
digital circuits, but as it by default contains a Frobenius structure,
\emph{too many} equations would hold.

Not all is lost; since the issue only arises with the interactions between the
monoid and the comonoid, we can use cospans of hypergraphs to reason modulo the
equations of just one of the two structures.
This means that not all of the equations of a bialgebra will be absorbed into
the combinatorial structure, but this is better than too many taking effect!

\begin{remark}
    Alas, we cannot claim to have pioneered the idea of interpreting terms with
    just a monoid or comonoid structure as cospans of
    hypergraphs~\cite{fritz2023free,milosavljevic2023string}.
    What we bring to the table is studying how such terms interact with the
    \emph{trace}; does removing acyclicity lead to any degeneracies?
\end{remark}

In the case of sequential circuits, it makes sense to focus on the comonoid
structure, as forking wires is far more of a natural concept than joining them.
To characterise categories of terms with a comonoid structure, we must first
define the monoidal theory of commutative comonoids.

\begin{definition}
    Let \((\generators[\ccomon], \equations[\ccomon])\) be the symmetric
    monoidal theory of \emph{commutative comonoids}, with \(
    \Sigma_{\ccomon} \coloneqq \{
    \iltikzfig{strings/structure/comonoid/copy}[colour=white],
    \iltikzfig{strings/structure/comonoid/discard}[colour=white]
    \}
    \) and \(\mce_{\ccomon}\) defined as in \cref{fig:comonoid-equations}.
    We write \(
    \ccomon \coloneqq \smc{\generators[\ccomon], \equations[\ccomon]}
    \).
\end{definition}

\input{sections/graphs/interpretation/floats/comonoid-equations}

From now on, we write `comonoid' to mean `commutative comonoid'.

When identifying the cospans of hypergraphs that correspond to terms with traced
comonoid structure, the notion of monogamy will once again need to be modified.
Partial monogamy is now too strong, as with a comonoid structure we actually
want wires to fork!
Weakening to no monogamy at all is too much, as we do not want wires to join as
well as fork.
Effectively, we want vertices to be `monogamous on one side'.

\begin{definition}[Partial left-monogamy]
    For a cospan \(\cospan{m}[f]{H}[g]{n}\), we say it is
    \emph{partial left-monogamous} if \(f\) is mono and, for all nodes
    \(v \in H_\star\), the degree of \(v\) is \((0,m)\) if \(v \in f_\star\) and
    \((0,m)\) or \((1,m)\) otherwise, for some \(m \in \nat\).
\end{definition}

Partial left-monogamy is a weakening of partial monogamy that allows vertices
to have multiple `out' connections, which represent the use of the comonoid
structure to fork wires; vertices must still only have one `in' connection.

\begin{figure}
    \centering
    \[
        \underbrace{
            \iltikzfig{graphs/monogamy/yes-comonoid-0}
            \iltikzfig{graphs/monogamy/yes-comonoid-1}
        }_{\text{partial left-monogamous}}
        \qquad
        \underbrace{
            \iltikzfig{graphs/monogamy/no-comonoid-0}
            \iltikzfig{graphs/monogamy/no-comonoid-1}
        }_{\text{not partial left-monogamous}}
    \]
    \caption{Examples of cospans that are and are not partial left-monogamous}
    \label{fig:partial-left-monogamous-examples}
\end{figure}

\begin{example}
    Examples of cospans that are and are not partial left-monogamous are shown
    in \cref{fig:partial-left-monogamous-examples}.
\end{example}

\begin{remark}
    As with the vertices not in the interfaces with degree \((0, 0)\) in the
    vanilla traced case, the vertices not in the interface with degree
    \((0, m)\) allow for the interpretation of terms such as \(
    \trace{}{\iltikzfig{strings/structure/comonoid/copy}[colour=white]}
    \).
    \[
        \frobtohypsigma[\trace{}{\iltikzfig{strings/structure/comonoid/copy}}]
        =
        \trace{}{\frobtohypsigma[\iltikzfig{strings/structure/comonoid/copy}]}
        =
        \trace{}{\iltikzfig{graphs/fork-cospan}}
        =
        \iltikzfig{graphs/trace-fork-cospan}
    \]
\end{remark}

We must ensure that partial left-monogamy is preserved by the categorical
operations, so partial left-monogamous cospans form another PROP.

\begin{lemma}\label{lem:partial-monogamous-id-sym}
    Identities and symmetries are partial left-monogamous.
\end{lemma}
\begin{proof}
    Again by \cref{lem:identities-symmetries-monogamous}, identities and
    symmetries are monogamous so they are also partial left-monogamous.
\end{proof}

\begin{lemma}
    Given partial left-monogamous cospans
    \(\cospan{m}{F}{n}\) and
    \(\cospan{n}{G}{p}\), the composition \(
    (\cospan{m}{F}{n})
    \seq
    (\cospan{n}{G}{p})
    \) is partial left-monogamous.
\end{lemma}
\begin{proof}
    We only need to check the in-degree of vertices, as the out-degree can be
    arbitrary.
    Only the vertices in the image of \(n \to G\) have their in-degree modified;
    they will gain the in-tentacles of the corresponding vertices in the image
    of \(n \to F\).
    Initially the vertices in \(n \to G\) must have in-degree \(0\) by partial
    monogamy.
    They can only gain at most one in-tentacle from vertices in \(n \to F\)
    as each of these vertices has in-degree \(0\) or \(1\) and \(n \to G\) is
    mono.
    So the composite graph is partial left-monogamous.
\end{proof}

\begin{lemma}
    Given partial left-monogamous cospans \(\cospan{m}{F}{n}\)
    and \(\cospan{p}{G}{q}\), the tensor \(
    (\cospan{m}{F}{n})
    \tensor
    (\cospan{n}{G}{p})
    \) is partial left-monogamous.
\end{lemma}
\begin{proof}
    The elements of the original graphs are unaffected so
    the degrees are unchanged.
\end{proof}

This means we can assemble the partial left-monogamous cospans of hypergraphs
into the desired sub-PROP.

\begin{definition}
    Let \(\plmcspdhyp\) be the sub-PROP of \(\cspdhyp\) containing only the
    partial left-monogamous cospans of hypergraphs.
\end{definition}

As this PROP is not restricted to acyclic cospans like those used for just
terms with a (co)monoid structure, it has the additional structure of a trace.

\begin{proposition}
    The canonical trace is a trace on \(\plmcspdhyp\).
\end{proposition}
\begin{proof}
    We must show that for any set of vertices in the image
    of \(x + n \to K\) merged by the canonical trace, at most one of them can
    have in-degree \(1\).
    But this must be the case because any image in the image of
    \(x + m \to K\) must have in-degree \(0\), and \(x + m \to K\) is
    moreover mono so it cannot merge vertices in the image of
    \(x + n \to K\).
\end{proof}

We now have the setting in which we will model terms with a comonoid structure.
To actually define the mapping from \(\stmcsigmac + \ccomonc\) we will reuse
some ingredients from the previous sections.

\begin{definition}
    Let \(
    \morph{
        \comonoidtofrob
    }{
        \ccomon
    }{
        \frob
    }
    \) be the embedding of \(\ccomon\) into \(\frob\), and let \(
    \morph{
        \tracedandcomonoidtofrobsigma
    }{
        \stmcsigma + \ccomon
    }{
        \smcsigma + \frob
    }
    \) be the copairing of \(\tracedtosymandfrobsigma\) and
    \(\comonoidtofrob\).
\end{definition}

\begin{corollary}
    \(\comonoidtofrob\) and \(\tracedtosymandfrobsigma\) are faithful.
\end{corollary}

After translating from \(\stmcsigmac + \ccomonc\) to \(\smcsigmac + \frob\),
we can then use the previously defined PROP morphism \(\termandfrobtohypsigmac\)
to obtain a cospan of hypergraphs; as before, these PROP morphisms are
summarised in \cref{fig:roadmap}.
To show that partial left-monogamy is the correct notion to characterise terms
in a traced comonoid setting, it is necessary to ensure that the image of these
PROP morphisms actually lands in \(\plmcspdhyp\).
First we verify that this

\begin{lemma}
    The image of \(\frobtohypsigma \circ \comonoidtofrob\) is in
    \(\plmcspdhyp\).
\end{lemma}
\begin{proof}
    This is straightforward by inspecting the cases.
\end{proof}

To show the correspondence between \(\stmcsigma + \ccomon\) and
\(\plmcspdhyp\), we use a similar strategy to \cref{thm:termtohyp-image}.

\begin{lemma}\label{lem:discrete-mono}
    Given a discrete hypergraph \(X \in \hypsigma\), any cospan
    \(\cospan{m}[f]{X}{n}\) with \(f\) mono is in the image of
    \(\frobtohypsigma \circ \comonoidtofrob\).
\end{lemma}

\begin{theorem}\label{thm:comonoid-fully-complete}
    A cospan of hypergraphs is in the image of
    \(\stmcsigma + \ccomon \cong \plmcspdhyp\) if and only if it is partial
    left-monogamous.
\end{theorem}
\begin{proof}
    It suffices to show that a cospan \(\cospan{m}{F}{n}\) in
    \(\plmcspdhyp\) can be decomposed into a traced cospan in which every
    component under the trace is in the image of either
    \(\termandfrobtohypsigma\) or \(\frobtohypsigma \circ \comonoidtofrob\).
    This is achieved by taking the construction of \cref{thm:termtohyp-image}
    and allowing the first component to be partial left-monogamous; by
    \cref{lem:discrete-mono} this is in the image of
    \(\frobtohypsigma \circ \comonoidtofrob\).
    The remaining components remain in the image of \(\termtohypsigma\).
    Subsequently, the entire traced cospan must be in the image of \(
    \termandfrobtohypsigma \circ \tracedandcomonoidtofrobsigma
    \).
\end{proof}

As \(\termandfrobtohypsigma\) and \(\tracedandcomonoidtofrobsigma\) are
faithful, we immediately find the following.

\begin{corollary}
    There is an isomorphism of coloured PROPs
    \(\stmcsigma + \ccomon \cong \plmcspdhyp\).
\end{corollary}

This means the PROP \(\plmcspdhyp\) of partial left-monogamous cospans of
hypergraphs is suitable for modelling terms in \(\stmcsigma + \ccomon\):
traced terms with a comonoid structure.

\subsection{Traced coloured comonoids}

As usual, the results of the monochromatic setting generalise in a
straightforward manner to the multicoloured setting.
As with \(\frob\), a multicoloured version of \(\ccomon\) is defined as a
coproduct in \(\cprop\).

\begin{definition}
    For a countable set of colours \(C\), let
    \(\ccomonc \coloneqq \Sigma_{c \in C} \ccomon\).
\end{definition}

Partial left-monogamy follows as before, so we have a traced coloured PROP.

\begin{definition}
    Let \(\plmcspdchyp\) be the sub-PROP of \(\cspdchyp\) containing only the
    partial left-monogamous cospans of hypergraphs.
\end{definition}

\begin{proposition}
    The canonical trace is a trace on \(\plmcspdhyp\).
\end{proposition}

\begin{definition}
    Let \(
    \morph{
        \comonoidtofrob
    }{
        \ccomon
    }{
        \frob
    }
    \) be the embedding of \(\ccomon\) into \(\frob\), and let \(
    \morph{
        \tracedandcomonoidtofrobsigma
    }{
        \stmcsigma + \ccomon
    }{
        \smcsigma + \frob
    }
    \) be the copairing of \(\tracedtosymandfrobsigma\) and
    \(\comonoidtofrob\).
\end{definition}

\begin{corollary}
    \(\comonoidtofrob\) and \(\tracedtosymandfrobsigma\) are faithful.
\end{corollary}

\begin{theorem}\label{thm:comonoidc-fully-complete}
    A cospan of hypergraphs is in the image of
    \(\stmcsigma + \ccomon \cong \plmcspdhyp\) if and only if it is partial
    left-monogamous.
\end{theorem}

\begin{corollary}
    There is an isomorphism of coloured PROPs
    \(\stmcsigma + \ccomon \cong \plmcspdhyp\).
\end{corollary}