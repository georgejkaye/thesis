\section{Normalising circuits}

We can now translate any circuit into a denotationally-equal Mealy form using
equations in \(\mealyeqn\); what now?
As mentioned in the previous section, there is no guarantee that the
combinational cores of Mealy forms have the same semantics, even if the state
word is the same.
Even so, one might think that through some combination of sliding components
around the trace and across the delay, one might stumble across a way of
translating one circuit into another.
Unfortunately, these is simply \emph{not sufficient} for
translating between circuits with the same semantics.

\begin{example}
    Consider the following circuit in \(\scirc{\belnapsignature}\): \[
        \iltikzfig{circuits/examples/state-change/circuit}
        \quad
        \iltikzfig{circuits/examples/state-change/circuit-simpler}
    \]
    The registers will \emph{always} contain
    \(\belnapfalse\) and \(\belnaptrue\) and both circuits will
    produce a constant \(\belnapfalse\) output, so a complete equational theory
    should be able to translate between them.
    To this end, we assemble these into Mealy forms with the same initial states:
    \[
        \iltikzfig{circuits/examples/state-change/circuit-mealy}
        \quad
        \iltikzfig{circuits/examples/state-change/circuit-simpler-mealy}
    \]
    The combinational cores do \emph{not} have the same semantics!
    They only act the same because they receive certain inputs
    from \(\valuetuple{3}\).
\end{example}

We must take \emph{context} into account when defining
equations; unfortunately equations that only deal with the interactions between
individual generators are not enough.

Instead, our strategy is to translate circuits in Mealy form into some sort of
`normal form', from which it is clearer which circuits have the same behaviour.
We take inspiration from a form we have seen already: the image of
\(\mealytocircuiti\).
Not only is this image characterised by circuits in Mealy form, but their state
word have the special property that their length is the equal to the number of
states the (underlying Mealy machine of the) circuit can assume, and only
contain \(\bot\) and \(\top\).
From the completeness procedure for the denotational semantics, we know that any
circuit is guaranteed to be denotationally equivalent to a circuit in this form;
if we have equations to translate any circuits with the same behaviour to this
circuit, then we have a complete algebraic semantics.

When working with syntactic circuits rather than stream functions, there may be
many circuits that correspond to the same behaviour.
To reduce the confusion when talking about a circuit, we will first introduce
equations for translating a combinational circuit into a `canonical' version
from which it is straightforward to read off its behaviour.
For functionally complete interpretations, such a candidate presents itself
immediately in the form of the map \(\mealytofunc\) from \(\funci\) to
\(\scircsigma\), which maps any (combinational) function to a particular
circuit.

\begin{definition}[Normalised circuit]
    A sequential circuit \(
        \iltikzfig{strings/category/f}[box=f,colour=seq,dom=\listvar{m},cod=\listvar{n}]
    \) is \emph{normalised} if it is in the image of \(\mealytofunc\).
\end{definition}

\begin{remark}
    Recall that even though \(\mealytofunc\) maps into \(\scircsigma\), every
    circuit in its image has combinational behaviour; the image of
    \(\mealytofunc\) is constrained in such a way that the instantaneous values
    can be used as constants.
\end{remark}

As the normalised version of a given circuit is interpretation-dependent, there
is no standard set of equations for normalising a circuit.
Instead, these must be specified on a interpretation-by-interpretation basis.

\begin{definition}[Normalising equations]
    For a functionally complete interpretation \(\interpretation\), a set of
    equations \(\normalisingequations\) is \emph{normalising} if any
    compositional circuit \(
        \iltikzfig{strings/category/f}[box=f,colour=comb,dom=\listvar{m},cod=\listvar{n}]
    \) is equal to a circuit in the image of \(\mealytofunc\) by equations in
    \(\normalisingequations\).
\end{definition}

\begin{example}
    We will discuss the normalising equations required for the Belnap
    interpretation in \cref{sec:algebraic-case-study}.
\end{example}

The aim of the normalising equations for an interpretation translate a
combinational core into a form from which it is easy to read off a truth table.
Note that we only require the normalising equations to translate circuits with a
\emph{single} output; this means we will need a way to express each output of
a combinational core as an independent circuit.
This is also important as we need to distinguish which outputs of the core
contribute to the next state, and which to the outputs of the entire circuit.

\begin{definition}[Normalised Mealy form]
    A sequential circuit is in \emph{normalised Mealy form} if it is in the form
    \(
        \iltikzfig{circuits/axioms/encoding}[transition={f_0},output={f_1},dom=m,cod=n,delay=x]
    \) where \(
        \iltikzfig{strings/category/f-2-1}[box=f_0,colour=seq]
    \) and \(
        \iltikzfig{strings/category/f-2-1}[box=f_1,colour=seq]
    \) are normalised circuits with isolated outputs.
    Given such a circuit, we write \(
        \morph{\tilde{f}_{0}}{\valuetuple{x+m}}{{\valuetuple{x}}}
    \) and \(
        \morph{\tilde{f}_{1}}{\valuetuple{x+m}}{{\valuetuple{n}}}
    \) for the functions that satisfy \(
        \mealytofunc[\tilde{f}_{0}] = \iltikzfig{strings/category/f-2-1}[box=f_0,colour=seq]
    \) and \(
        \mealytofunc[\tilde{f}_{1}] = \iltikzfig{strings/category/f-2-1}[box=f_1,colour=seq]
    \).
\end{definition}

A set of normalising equations will not necessarily translate a circuit into
normalised Mealy form, as the transition and



The combinational core of a circuit in Mealy form computes the next state
transition and the output given the current state and input.
However, to compute all the states of a circuit we will need to explicitly know
which components
The first thing to do is to \emph{isolate} the two, so it is clear

\begin{definition}[Isolated outputs]
    A sequential circuit \(
        \iltikzfig{strings/category/f}[box=f,colour=seq,dom=m,cod=n]
    \) has \emph{isolated outputs} if \(\listvar{n}\) has length \(1\) or the
    circuit is of the form \(
        \iltikzfig{circuits/algebraic/isolated-outputs}
    \) where \(k\) has length \(1\) and \(
        \iltikzfig{strings/category/f}[box=f_1,colour=seq,dom=\listvar{m},cod=\listvar{p}]
    \) has isolated outputs.
\end{definition}

\begin{example}
    \todo[inline]{Do SR latch example}
\end{example}



Mealy form itself is already a sort of normal form, but there is no restriction
on how the combinational core is defined.


\section{Case study: The Belnap interpretation}

\todo[inline]{The normalising equations for the Belnap interpretation}